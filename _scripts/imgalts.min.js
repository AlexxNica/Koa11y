//Image Alts Script v4
console.clear(),window.xhrWorked=!0;var xhr=new XMLHttpRequest,img=document.getElementsByTagName("img"),imgLen=img.length,altLen=0,bigAlt=imgLen,bigImg=imgLen,imgErr=0,imgSizes=0,missedImg=0,imgAlts=[],i=0;if(imgLen<1)console.log("No images found on this page.");else{for(i=0;i<imgLen;i++){img[i].getAttribute("alt")&&imgAlts.push(img[i]);try{xhr.open("HEAD",img[i].getAttribute("src"),!1),xhr.onreadystatechange=function(){if(4==xhr.readyState)if(200==xhr.status){var a=xhr.getResponseHeader("Content-Length");a=parseInt(a),isNaN(a)?missedImg+=1:(imgSizes+=a,a>102400&&bigImg--)}else imgErr++},xhr.send(null)}catch(a){window.xhrWorked=!1}}for(var j=0;j<imgAlts.length;j++){var currentAlt=imgAlts[j].getAttribute("alt");currentAlt.length>100&&bigAlt--;var descriptive=confirm("Is this text descriptive: ("+j+"/"+imgAlts.length+")\n"+currentAlt);descriptive&&altLen++}var image="images";1==imgErr&&(image="image");var altPercent=Math.round(altLen/imgLen*100),under100KB="?",failPercent="?",sizeUnder100="?",loaded="?",KB="?",good="text-success glyphicon-ok",bad="text-danger glyphicon-remove",warn="text-warning glyphicon-ban-circle",altIcon=good,lengthIcon=good,sizeIcon=warn,errorIcon=warn,missImgWarn="",testable="";missedImg>0&&(missImgWarn=' title="Could not verify '+missedImg+' images."'),1==missedImg&&(missImgWarn=' title="Could not verify '+missedImg+' image."'),altPercent<100&&(altIcon=bad),bigAlt>imgLen&&(lengthIcon=bad),imgErr>0&&(errorIcon=bad),bigAlt>0&&xhrWorked&&(sizeIcon=good,bigImg>0&&(sizeIcon=bad),errorIcon=good,sizeUnder100=bigImg,loaded=imgLen-imgErr,KB=Math.round(imgSizes/1024*10)/10,under100KB=Math.round(bigImg/imgLen*100),failPercent=Math.round((imgLen-imgErr)/imgLen*100),100==under100KB&&(sizeIcon=good),missedImg>0&&(sizeIcon=warn,loaded-=missedImg,sizeUnder100-=missedImg,testable="testable "),missedImg>0&&errorIcon==good&&(errorIcon=warn));var lastTwo='      <p><i class="glyphicon '+sizeIcon+'"'+missImgWarn+"></i> <strong>"+under100KB+"%</strong> of "+testable+"images were under 100KB in size. <strong>("+sizeUnder100+"/"+imgLen+')</strong></p>\r\n      <p><i class="glyphicon '+errorIcon+'"'+missImgWarn+"></i> <strong>"+failPercent+"%</strong> of "+testable+"images loaded with a total image payload of <strong>"+KB+"KB ("+loaded+"/"+imgLen+")</strong></p>\r\n";"?"==under100KB&&"?"==failPercent&&"?"==sizeUnder100&&"?"==KB&&"?"==loaded&&(lastTwo='      <p><i class="glyphicon '+warn+"\"></i> The requested URL blocks cross-origin resource sharing of images (CORS), so we couldn't verify the image file sizes.</p>\r\n"),console.clear();var output='<div class="row">\r\n  <div class="panel panel-primary">\r\n    <div class="panel-heading">Image Accessibility</div>\r\n    <div class="panel-body">\r\n      <p><i class="glyphicon '+altIcon+'"></i> <strong>'+altPercent+"%</strong> of images on the page had descriptive ALT text. <strong>("+altLen+"/"+imgLen+')</strong></p>\r\n      <p><i class="glyphicon '+lengthIcon+'"></i> <strong>'+Math.round(bigAlt/imgLen*100)+"%</strong> of ALTs were under 100 characters. <strong>("+bigAlt+"/"+imgLen+")</strong></p>\r\n"+lastTwo+"    </div>\r\n  </div>\r\n</div>";console.log(output);var dummy=document.createElement("textarea");dummy.setAttribute("id","dummy"),document.body.appendChild(dummy);var dumNode=document.getElementById("dummy");dumNode.value=output,dumNode.select(),document.execCommand("copy"),document.body.removeChild(dumNode),console.log("The above code has been copied to your clipboard")}
